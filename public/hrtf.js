const hrtf = {
    'azimuth': '-20',
    'elevation': '180',
    'left': [0,0,0,0,0,0,0,0,2.1255992131895682E-7,3.5789237849039156E-7,-9.1612051937096719E-7,2.9988579828039304E-6,-0.00012110880687825026,-0.000306931304211067,-0.00050562004501335863,-0.0013973888146304881,-0.0013706000496704071,-0.0025694394441912009,-0.00397871730441611,-0.00326313008200744,-0.0041835344615339916,-0.002850284158962903,-0.0049157506381860509,-0.0062774213866026518,-0.0038854437126216185,0.0278936431645233,-0.010195742214115334,-0.040819719545307678,0.017735614673714893,-0.0054652972757233157,-0.022802853752160936,-0.0012164297559292875,-0.019001816318721821,0.0223122146244847,-0.001876623827241826,0.35085927886642032,0.55768095627506709,-0.097152867895222858,0.048754318989803092,0.02758807263092972,-0.10858560638246868,-0.133373846994138,-0.26863078980344574,0.11335197482484043,-0.34381754266336834,-0.48353240218286014,0.1647813606370569,0.13308077903733498,-0.036855833143082592,-0.023172364900539054,-0.01125824367914712,0.076366321015722563,-0.045598336206794564,-0.12209762020671339,-0.0353578385412574,-0.067379232904984876,-0.063251543498240526,-0.093521774553681561,-0.0093193552392169428,-0.0044615674544383043,-0.094099803271692886,0.024353874336075648,0.050610377299299361,0.020341490795296777,-0.041064133995531958,-0.015485165762741815,0.062106965875190073,0.0058612256141766864,-0.054017853783703919,-0.03477251087064074,0.00028417424902744048,-0.00638309126855337,-0.012090448314401099,-0.015247549982769828,-0.012212650313705517,-0.019582570169876693,-0.0075806480038845417,0.0023391223853821436,-0.0030660348642012067,-0.013987180175887449,1.3618591138655296E-5,0.0342914936670487,0.032593360133916983,0.025532875806078232,0.015320097236419946,0.017714987548717736,0.019850515250105321,0.010393230290782159,0.002549856416771253,-0.0033442663358340323,0.0017657918433890329,-0.0084601420807868376,0.002617161457575175,0.012319208522011179,0.009151324728562853,0.011752090624253956,0.007029652610417568,0.013392023558951022,0.0063416969039504032,0.0012323004767940643,0.0055242379168517972,-0.005695591027019809,-0.010682753335942303,-0.0063512180373394471,-0.0071987582647048765,0.0020879366883565574,-0.00066156844768813273,-0.00582346679056115,-2.0289322555190655E-5,-0.00067599642210841419,0.00095854006671718106,-0.00049762630500414784,0.0009769515437499602,0.0044027331210957886,-0.0023897265805713002,-0.0025910688820052876,0.0061192939168594213,-0.0030736669637928516,-0.0031613103501341206,-0.0015224247127814036,-0.0056385849207953725,-0.002299790285775228,-0.0086015277499292674,-0.0031388045206236109,-0.0028179288116690249,-0.014147082889538937,-0.010088165302955828,-0.012473948859530657,-0.010377051033226618,-0.0086081898348656059,-0.014517201707047019,-0.0096757672074993927,-0.013826860603078115,-0.014990148860285296,-0.012537848645312282,-0.010366442361265401,-0.0029258894781954642,-0.0019358547430856257,0.00765196128814152,0.021223010797335927,0.018688450861599041,0.022097881968309648,0.019947372332245944,0.016005121868407184,0.014198628005385284,0.0059598791227588755,0.0029605525075621004,-0.0049445181800618025,-0.0084575854396830262,-0.0077734574248179006,-0.011699181977879336,-0.0082117520214657434,-0.0017115944352503328,-0.0047706476065024006,-0.00026650286414084461,-3.8069839721009494E-5,-0.00073610084462240593,-0.001069756186681483,-0.001817935667899956,0.0017388512184560332,-0.0045139033817652736,-0.0061798054752222045,0.00069685222365912982,-0.0041554543071933864,-0.0023727439219508638,-0.0013863694961482845,-0.0044000737090842332,-0.0010089734050287764,-0.00068982150230467287,0.00059739776569709953,0.00099671100105888926,5.7366943397577213E-5,0.00013537074050856021,-0.00088651249833166044,-0.0012001832087568192,-0.00055458683108003252,-0.0027201146849395535,-0.0035876759017845765,-0.0020106624003555533,-0.0001763382811241718,-0.00017165314184806833,-0.0020510023012797556,-0.0012056967148290254,-0.0010776847671155987,-0.0022254508297770473,-0.0022073840026582674,-0.0016037525952052941,-0.0016716004272443151,-0.0024795681223898792,-0.0021239037349393792,-0.0007066221113354881,-0.00018832379584853151,-0.00062086861359857311,-0.00034369746261975339,2.873219264337877E-5,0.00011663861428971392,0.00012498061865881424,-1.7729529358650931E-5,2.6331241246037425E-5,7.0147435206600458E-5],
    'right':[0,0,0,0,0,0,0,0,1.422005749469006E-7,-3.7479837392956818E-7,1.8285229548825977E-6,-6.393996658663716E-6,-3.7146645568623291E-5,-8.1734954904696115E-5,-0.00031395266975111746,-0.00054276242459124673,-0.001312005066908407,-0.0025213790019375563,-0.00162401656903827,-0.0027743395586811818,-0.0032032426474894017,-0.00086879552218196586,-0.002536867250581248,-0.0015765018421654441,-0.0029783788866550179,-0.0040465834499287551,-0.0037459408222440538,-0.0039762897451822519,-0.0036029621581227318,-0.0048051215107731918,-0.0045123843427880206,-0.0045588861612427,0.012919660318762955,-0.0040197127048623854,-0.0156088441118353,-0.0021491176766396409,-0.015098350305139998,0.00092812943969112734,-0.0062880460608878037,-0.0040239619144981312,-0.00087656798735780692,0.011964218328020941,-0.0025818385463248659,0.19640286681197766,0.33535859373232491,0.12566022132075733,0.12324788260949505,-0.025593706248807677,-0.15399649940552934,-0.21519120377815787,-0.29004313608522342,-0.046189342329075,0.0045562129631614989,-0.083906604259036816,0.039415651745915416,0.073128009436011,0.048023294047645722,-0.024293540017187188,-0.053512489247110238,-0.036650544383976212,-0.034357333134722473,-0.05200467167147204,-0.055100406196595161,-0.031162647240037776,-0.024773487909554283,-0.0449952203267567,-0.01622131072000331,-0.0066936993939642805,-0.033167568432918126,-0.027854940391597888,0.0044875534036600152,0.013758839722967353,-0.0176607169099313,-0.006154652929677238,-0.0010890553406870738,-0.0079185197373093513,-0.00437281428780396,-0.0056727894822042376,-0.010948021526443483,-0.01333956662638338,-0.01727065287243143,-0.0099095417069217009,-0.017562737088475524,-0.030241995986567207,-0.03306392685152526,-0.029102190054521984,-0.026370653905045071,-0.022941320009315976,-0.012246131996848068,-0.0044410462798966828,0.0010327115925126524,0.000676885645138945,0.0030723790397373576,0.0078279446176222345,0.0016193643830238198,-0.0015904844843161181,-0.00058087544868728948,-0.00548120377180595,-0.0071393610267929579,-0.0062835232007274885,-0.003327518056994945,-0.0017795317280310391,0.00079627083331368874,0.0019276780481396289,0.0044534699530324054,0.005388555845543555,0.0043420689191050153,0.0024980834530600633,0.0016364274642147955,0.00024500517338913439,-0.00091254179312440112,-0.0026003828673036439,-0.0042883083787721276,-0.0043795651531508429,-0.0049184902966264536,-0.0027527469272088734,0.0013804495465474706,-0.00067397866507108088,0.000714229413992233,0.0019070280926613082,0.000802391391198538,0.0014859232846849688,-0.0013733934536537696,-0.0027413189695728794,-0.003479916005496297,-0.00611794196442853,-0.00636237899083042,-0.0045743050781303415,-0.0024974017117822792,-0.002298576434957914,-0.0020889530056686836,-0.0027319914666868268,-0.0020505041370642622,0.00012685227733993915,-0.00295675511092869,-0.0050716368751417794,-0.0074382568843266153,-0.0069441561376666827,-0.0087463164459515227,-0.006404604345679102,-0.005069610648548115,-0.00433011175424247,-0.0017212740564389877,-0.0046077855973713621,-0.0052558098432216845,-0.0077636758195927117,-0.01209023630167996,-0.01140684635564067,-0.01096026737012369,-0.006467789688889343,-0.0016744647282702415,-0.0014988603339357205,0.00027977420362432519,-0.0036071494947608044,-0.005969501319578561,-0.0034507123689564729,-0.0018342041565449364,-0.0011831996802712165,-0.00024223705273587959,0.0040166866400115579,0.0029717916334752611,-0.0013555866894345754,-6.9600678053595175E-5,-0.0012762239798863658,-0.0021547520111914412,-0.0014579141902828039,0.00142730707914519,0.0022238453840155445,0.00044185717775492919,-0.00018546488003582675,0.00027517787758725014,-0.00099024700906357832,-0.0013597347982436225,-0.0017391545531836683,-0.00088277827293668223,8.05518542456349E-5,-0.0006468466055231264,-0.00069852577077785471,7.7339515103789859E-6,-6.4531027411512563E-5,0.00020633814356227221,0.0011985330600864819,0.0013128576214114561,0.0004641789042645713,0.00093681148324266351,0.0011690992370956886,0.00096848281469717583,0.000295870207822151,-0.0002811487087525908,2.9996184305492684E-5,-4.0654203283084844E-5,-0.0001079364592665321,-5.8245124968908589E-5,-8.54814701080699E-5,-7.0633355240732487E-5,-0.000218352981719991,-0.00020105319582466239,-0.00025219016175076167,-0.00027978480558652689,-0.00026927135611022526]

}

const startButton = document.getElementById('start')

startButton.addEventListener('click', () => {
    
    // Crea contexto de audio
    const audioCtx = new AudioContext();

    const audioElement = new Audio ('/media/Pirates_4channels/AuSep_1_vn_24_Pirates.wav')
    audioElement.setAttribute('controls','controls');
    document.body.appendChild(audioElement);
    
    // Respuesta al impulso del convolver
    async function loadIR(irUrl) {
        const convolverNode = audioCtx.createConvolver();
        convolverNode.normalize = false;
        let response = await fetch(irUrl);
        let arraybuffer = await response.arrayBuffer();
        convolverNode.buffer = await audioCtx.decodeAudioData(arraybuffer);
        return convolverNode;
    }
    // imp = audioCtx.createBuffer(1,200,44100);

    // nowBuffering = imp.getChannelData(0);
    
    // for (let i = 0; i < 200; i++){
    //     nowBuffering[i] = hrtf.left[i];
    // }
    
    // convolverNode.buffer = imp;

    async function init (){

        // Crea un nodo fuente
        const sourceNode = audioCtx.createMediaElementSource(audioElement);

        convolverNode_left = await loadIR('/media/hrtf/hrtf_left.wav');
        convolverNode_right = await loadIR('/media/hrtf/hrtf_right.wav');

        sourceNode.connect(convolverNode_left);
        sourceNode.connect(convolverNode_right);

        const gainNode = audioCtx.createGain();

        convolverNode_left.connect(gainNode);
        convolverNode_right.connect(gainNode);

        gainNode.connect(audioCtx.destination);        

    }

    init();
    
});