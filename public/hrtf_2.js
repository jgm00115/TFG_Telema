const hrtf = {
    'azimuth': '-20',
    'elevation': '180',
    'left': [2.149878669138705E-7,-1.0373194370577964E-7,-4.7478141587448896E-7,-2.6188481022541176E-5,-0.00012139139694370306,-0.00025672857062235705,-0.00077726013089112259,-0.00075804544032349983,-0.0016535616871355468,-0.0020448801320664097,-0.0022600869635513664,-0.00295315135160458,-0.0056752531812405086,-0.0012358691775170955,0.012247998349848179,-0.006183035303130891,-0.016630812206991266,0.0096820588910761021,0.0058111360848359384,-0.0253255131268312,-0.0012789952273300565,-0.0072439104942300008,0.0019761359591757678,0.0011261752516921095,0.52022031616345243,1,0.18463348881246758,-0.30842783223255921,-0.72202566493392029,-0.61158634718846783,-0.24783838746291048,-0.55046071709325672,0.58026410095381253,0.43413859640579544,-0.31910219805971435,0.067525042568937682,0.01147242242632516,0.0717621696594846,-0.17091705329315532,-0.12876980399325488,-0.072732524825116454,0.044745084446228468,0.070219575064233167,-0.15611143527812235,-0.060129539878889429,0.0078144862092132429,0.0017194543554002496,-0.038536082876785963,0.095559644175482822,-0.044695678180908305,-0.121718669392079,0.00032296924439976225,-0.00075137250852181953,0.0052859510351458755,-0.075069414127866441,-0.0011996148633758566,0.042104840577436936,0.036850696961860219,-0.0074690371013046986,-0.056123326593596,-0.031493840299564868,-0.011399575637881475,-0.015065421910106513,-0.017105071041357011,0.017477182537421119,0.00017850300218047287,0.019635165360911037,0.047531673576020367,0.037067853522717589,0.040573590911599525,0.021167412772008572,0.024485512164697184,0.022984730771887497,-0.012473705361824386,-0.017713180353465148,0.0092715636467202087,0.028908714315490826,0.02700023169409136,0.023290619158847333,0.012846175916907975,-0.0031247721663603431,-0.00024851939923231723,0.0058599956421612918,0.017636222717247997,0.01512728087949128,0.0082667813495695755,0.0170060793348131,0.016969785369917688,0.013673912296438656,-0.009447848443417884,-0.024062815320883345,-0.024403017970289556,-0.020375674799647889,-0.0019608952122498859,-0.0035454593376314947,0.005763950122797009,0.016312209043323551,-0.00588581260590246,-0.016262589539773661,-0.013910033134224566,-0.0098274894710925886,-0.0077220601775132916,0.00021467019567298628,0.0015966522411819449,-0.015262673583750335,-0.0078327070413936224,-0.0051127627699265659,-0.0075510775769558206,0.010561814228609856,-0.00045202677512340574,0.0042713396885148977,0.011785740941346741,-0.0032444697685320872,-0.0063054727645198688,-0.012955429087047372,0.0022819873053039007,0.0067503223432890539,-0.0033461012945470952,0.010273322508089671,0.0013757997961101475,-0.00447139212701366,0.0056324819805465918,0.0012887608855286269,0.00047407823399143805,-0.0058283153240485837,-0.0039716927357451668,0.0041777629880309971,0.0056369750026822587,0.0028271132421282038,0.00091481545721232641,-0.0022791926323086041,-0.0019358756476766819,0.00585868914604857,0.004381386500850978,0.0069756068129444527,0.0055426035135956436,-0.0013501051444267252,0.0011381569942004383,0.00090871337095883885,-0.0028178013864261419,-0.0047861764652304623,-0.0025428491191000612,-0.0021638660378269221,-0.0084985485519071431,-0.011788814311606357,-0.011553474518909018,-0.0063777575225254356,-0.0038001311461728351,-0.0070357656296605505,-0.0027596974188996083,-0.00516403092460018,-0.0058236646297878626,-0.0037591667438397797,-0.0069056406274958107,-0.005778346642537578,-0.0082290522177406056,-0.014562196368485261,-0.013121148905899809,-0.001991951322748865,0.011097304013093371,0.012615727980953563,0.0035668484901648224,0.0044025071196056786,0.0027911423671853632,-0.0047270721614084662,-0.0058727823362412675,-0.0051871108033265806,-0.00027601830010515519,-0.0025585556735292225,-0.0016540892213468598,0.0035728639596309003,0.00105299103732594,0.00095110766939238936,-0.0033712948633104374,-0.0047867288103257671,-0.00061641196848962918,-0.0013059930776830196,3.1970790077226015E-5,-0.00085419414778145,-0.00012531560180284776,0.0016130232802262609,-0.00032304841277810736,0.00041640786369314932,-0.00039689150038058258,-0.000993339605703826,-0.00018500662811990587,-0.00085263978585352763,-0.00074108193459152059,-0.00038347429991732553,-0.00018424395947133453,-4.9034892631206037E-5,0.00018128493896628204,0.00019025064475165505,-0.0001042866076340431,-0.00020470593409453193,-0.00014586867965917628,-5.3772054110790169E-5,-6.9507849304183375E-5,-2.3116039740570606E-5,3.8921660883757536E-6],
    'right': [-4.0046090183434753E-7,2.1768407718702131E-6,-1.2644814255627733E-5,-3.3225258466381854E-6,-7.97697000577894E-5,-0.000219669451756844,-0.00030211656189781274,-0.00068437797519599049,-0.000832370878003127,-0.0015524963986597261,-0.0016532862640404864,-0.001104893477388224,-0.0028985702080246674,-0.0024015932598381033,-0.0019506488517934059,-0.0026011862932523175,-0.002205676298128859,-0.0035893782914791315,-0.0032109409456161811,-0.0031038958310397285,-0.0037462957622506942,-0.0032031509784314566,-0.0034920428976845737,-0.0031453713818659621,-0.0025874817022924178,-0.0038816644811280831,-0.00393232807038007,-0.0038527150640428032,-0.0038508875915052119,-0.0024463254940746497,-0.0048255491445040573,-0.0036264950294693046,-0.00073684845774469395,-0.0063948132667294979,-0.0020676112054722456,-0.0026392659311377338,-0.0061775410629657176,-0.0019306612063791915,-0.0045710122805018294,-0.0031603100269296659,-0.0021408269355961676,-0.0036921858256924621,-0.0043595990326006093,-0.0050682289487060887,-0.0050957666731536178,-0.0030968435800289647,-0.0032147952739388815,-0.005161568586637349,-0.0071138804340158505,-0.0040994206525638895,-0.0015905637279755511,0.018547029325144865,0.096689948124756189,0.085467684329604554,0.041146326782043767,0.12021998649669093,0.037297088650013695,-0.089432742757420886,-0.040933591892423536,-0.054836846978386651,-0.060591103904707719,-0.0046805345405782394,-0.012910185050008214,0.00081013010324208724,-0.0016459604986673482,-0.021290348597633898,0.0029685481293736885,-0.013842012720592413,-0.056746857763929091,-0.045983276394087162,-0.028038566981099248,-0.036744818882106824,-0.039004615551379566,-0.028624169287435594,-0.021039676076644583,-0.022084489223586717,-0.014310841927669741,-0.011814414890814744,-0.012692564571996474,-0.010098259021145696,-0.01719482830134185,-0.015381657896041132,-0.012101393646818856,-0.013251722017803261,-0.020397261565421439,-0.019657888469604951,-0.01121783586575111,-0.014168102785505544,-0.014812465054677303,-0.011392294052233527,-0.010189786484604486,-0.010253615350844101,-0.011005363618326828,-0.011873331973534483,-0.0110449546353703,-0.015464037553240979,-0.017737962126829356,-0.013857837597086246,-0.011452423422327504,-0.0098484555146193548,-0.0073014354659735907,-0.0026415879769133253,-0.0011977723320558294,-0.000725373545755284,-0.00065807940609011466,0.0022377702903062578,0.0045355802344885388,0.0046280549138697042,0.0022844132506073932,0.00362907104676139,0.0040910229798296867,0.0032772813458505738,0.0042293493777573292,0.0042295515304661326,0.0053767244233514982,0.0073366592434744122,0.00811688629320341,0.0079395388747153343,0.0080822554043103127,0.006637188269852796,0.0060379916390101446,0.0031706020346867017,-0.00083931452011014947,-0.0024756988448200764,-0.003942576332143885,-0.0026172667466680334,0.00023205759319768306,0.0027973615960021261,-0.00330434988189363,0.0010425631702293094,0.0065479740911866353,-0.0055228588057766046,-0.0012146471343992143,0.0049109183350688557,-0.0072745866077924349,-0.0070851779677082605,-0.00032214057298376834,-0.0063112708692434523,-0.00781195533006775,-0.0040908336438296748,-0.0061307502207695467,-0.0088825902732449641,-0.0025386686596115958,0.0026589755933189288,-0.0032382913082230872,0.0032253843040109882,0.0075782536949416017,-0.0015617312207833233,-0.0017513931898762919,-0.0014490309870731771,-0.0063497116290451815,-0.0068674008586944177,-0.0031886666669989697,-0.00447534198827349,-0.0032790935355519893,-0.0017132552076038199,-0.0010505858892277441,-0.0027868931653541062,-0.0011789808907836034,-0.0022995972396579476,-0.0035130443668881946,-0.0023876230054668927,-0.00084428439936710053,-0.00075941163030060629,-0.00069898453969817009,0.00012644059430033387,0.00039748747057183407,0.0010050342547759093,0.0022551844509786558,0.0021466518094072672,0.0021633869904245191,0.0017781195560044516,0.0020083242272800825,0.0013356193356878442,0.000979223111593489,0.0014299978287220976,0.00075243469611734114,0.00084425102486803175,0.00088730054871693522,0.00086247830993851319,0.0011109966817799684,0.0011482863102077019,0.00096888113083816452,0.0012695983506623295,0.0012524754903707486,0.00082109825344524594,0.00091315615664840164,0.00066497016249283968,0.00040859290540865131,0.0004024381570724839,0.00028040239359982294,0.00026006099498834383,0.000246781355998852,0.00021025505255260667,0.00016133233845265051,0.0001114274288414837,7.632195314180164E-5,4.233898402109675E-5,2.2532161574312842E-5,1.2565804299045023E-5]


}

const startButton = document.getElementById('start')

startButton.addEventListener('click', () => {
    
    // Crea contexto de audio
    const audioCtx = new AudioContext();

    const audioElement = new Audio ('media/Pirates_4channels/test.wav')
    audioElement.setAttribute('controls','controls');
    document.body.appendChild(audioElement);

    const convolver = audioCtx.createConvolver();
    convolver.normalize = false;

    const buffer = audioCtx.createBuffer(2,200,audioCtx.sampleRate);
    let buffer_l = buffer.getChannelData(0);
    let buffer_r = buffer.getChannelData(1);
    for (let i = 0; i < 200; i++){
        buffer_l[i] = hrtf.left[i];
        buffer_r[i] = hrtf.right[i];
    }
    convolver.buffer = buffer;

    const sourceNode = audioCtx.createMediaElementSource(audioElement);
    sourceNode.connect(convolver);

    const splitter = audioCtx.createChannelSplitter(2);

    convolver.connect(splitter);

    const merger = audioCtx.createChannelMerger(2);
    splitter.connect(merger,0,0);
    splitter.connect(merger,1,1);
    merger.connect(audioCtx.destination);
});